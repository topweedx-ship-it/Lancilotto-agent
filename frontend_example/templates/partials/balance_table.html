{% if values and labels %}
<div style="height: 380px; padding: 0.5rem 0.25rem 0.75rem 0;">
    <canvas id="balanceChart" style="display:block; width:100%;"></canvas>
</div>
<script>
    (function () {
        const canvas = document.getElementById('balanceChart');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');

        const labels = {{ labels | tojson }};
        const data = {{ values | tojson }};

        new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Saldo USD',
                        data: data,
                        borderColor: '#2563eb',
                        backgroundColor: 'rgba(37, 99, 235, 0.08)',
                        borderWidth: 2,
                        pointRadius: 0,
                        tension: 0.25,
                    },
                    {
                        label: 'Valore iniziale',
                        data: Array(data.length).fill(data.length ? data[0] : null),
                        borderColor: '#9ca3af',
                        borderDash: [5, 4],
                        borderWidth: 1,
                        pointRadius: 0,
                        tension: 0,
                    },
                ],
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                layout: {
                    padding: {
                        left: 0,
                        right: 10,
                        top: 5,
                        bottom: 0,
                    },
                },
                interaction: {
                    mode: 'index',
                    intersect: false,
                },
                plugins: {
                    legend: {
                        display: true,
                        labels: {
                            color: '#374151',
                            font: { size: 11 },
                        },
                    },
                    tooltip: {
                        callbacks: {
                            label: function (context) {
                                const value = context.parsed.y;
                                return 'Saldo: $' + value.toFixed(2);
                            },
                        },
                    },
                },
                scales: {
                    x: {
                        ticks: {
                            color: '#4b5563',
                            maxTicksLimit: 6,
                            callback: function (value, index, ticks) {
                                const raw = labels[index];
                                const d = new Date(raw);
                                if (isNaN(d.getTime())) return raw;
                                return d.toLocaleString('it-IT', {
                                    day: '2-digit',
                                    month: '2-digit',
                                    hour: '2-digit',
                                    minute: '2-digit',
                                });
                            },
                        },
                        grid: { display: false },
                    },
                    y: {
                        ticks: {
                            color: '#4b5563',
                            callback: function (value) {
                                return '$' + value;
                            },
                        },
                        grid: {
                            color: 'rgba(148, 163, 184, 0.3)',
                        },
                    },
                },
            },
        });
    })();
</script>
{% else %}
<p>Nessun dato di saldo trovato.</p>
{% endif %}
